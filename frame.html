<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è¯»ä¹¦ä¼šå›¾ç‰‡ç¼–è¾‘å™¨</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fabric.js/5.3.0/fabric.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Microsoft YaHei', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            overflow: hidden;
        }
        
        .header {
            background: #2c3e50;
            color: white;
            padding: 20px;
            text-align: center;
        }
        
        .header h1 {
            font-size: 2.2em;
            margin-bottom: 10px;
        }
        
        .content {
            display: flex;
            min-height: 700px;
        }
        
        .sidebar {
            width: 350px;
            background: #f8f9fa;
            padding: 20px;
            border-right: 1px solid #e9ecef;
            overflow-y: auto;
        }
        
        .main-content {
            flex: 1;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-start;
        }
        
        .upload-area {
            border: 2px dashed #667eea;
            border-radius: 10px;
            padding: 30px;
            text-align: center;
            margin-bottom: 20px;
            background: #f8f9ff;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .upload-area:hover {
            background: #eef2ff;
            border-color: #764ba2;
        }
        
        .control-group {
            margin-bottom: 25px;
        }
        
        .control-group h3 {
            color: #2c3e50;
            margin-bottom: 15px;
            padding-bottom: 5px;
            border-bottom: 2px solid #667eea;
        }
        
        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            margin: 5px;
            transition: all 0.3s;
            width: calc(100% - 10px);
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }
        
        .btn-secondary {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        }
        
        .btn-success {
            background: linear-gradient(135deg, #4ecdc4 0%, #44a08d 100%);
        }
        
        .canvas-container {
            border: 2px solid #e9ecef;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            margin-bottom: 20px;
            background: #f8f9fa;
            min-height: 500px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        #canvas {
            background: white;
        }
        
        .frame-preview {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-bottom: 15px;
        }
        
        .frame-item {
            border: 2px solid #ddd;
            border-radius: 8px;
            padding: 8px;
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
        }
        
        .frame-item:hover {
            border-color: #667eea;
            transform: scale(1.05);
        }
        
        .frame-item.active {
            border-color: #667eea;
            background: #eef2ff;
        }
        
        .frame-item img {
            width: 100%;
            height: 60px;
            object-fit: cover;
            border-radius: 4px;
        }
        
        .frame-item .frame-name {
            font-size: 12px;
            margin-top: 5px;
            color: #666;
        }
        
        .custom-frame-input {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }
        
        .custom-frame-input input {
            flex: 1;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        
        .custom-frame-input button {
            padding: 8px 15px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        
        .sticker-position-controls {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 5px;
            margin-top: 10px;
        }
        
        .sticker-position-controls button {
            padding: 8px;
            background: #6c757d;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
        }
        
        .sticker-position-controls button:hover {
            background: #5a6268;
        }
        
        .text-style-controls {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 5px;
            margin-top: 10px;
        }
        
        .text-style-controls button {
            padding: 8px;
            background: #6c757d;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
        }
        
        .text-style-controls button:hover {
            background: #5a6268;
        }
        
        .color-picker {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-top: 10px;
        }
        
        .color-picker label {
            font-size: 12px;
            color: #666;
        }
        
        .color-picker input {
            width: 40px;
            height: 30px;
            border: 1px solid #ddd;
            border-radius: 4px;
            cursor: pointer;
        }
        
        .status-message {
            margin-top: 10px;
            padding: 10px;
            border-radius: 5px;
            text-align: center;
            font-size: 14px;
        }
        
        .success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        .hidden {
            display: none;
        }
        
        .instruction {
            font-size: 12px;
            color: #666;
            margin-top: 5px;
            text-align: center;
        }
        
        .lock-icon {
            color: #28a745;
            font-size: 14px;
            margin-left: 5px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ“š è¯»ä¹¦ä¼šå›¾ç‰‡ç¼–è¾‘å™¨</h1>
            <p>ä¸ºZoomæˆªå›¾æ·»åŠ ç›¸æ¡†ã€æ‰‹åŠ¿å›¾æ¡ˆå’Œæ–‡å­—æ¡† - æ–°ç›¸æ¡†è‡ªåŠ¨è¦†ç›–æ—§ç›¸æ¡†</p>
        </div>
        
        <div class="content">
            <!-- å·¦ä¾§æ§åˆ¶é¢æ¿ -->
            <div class="sidebar">
                <div class="upload-area" onclick="document.getElementById('imageUpload').click()">
                    <h3>ğŸ“ ä¸Šä¼ Zoomæˆªå›¾</h3>
                    <p>ç‚¹å‡»æˆ–æ‹–æ‹½å›¾ç‰‡åˆ°è¿™é‡Œ</p>
                    <input type="file" id="imageUpload" accept="image/*" class="hidden">
                </div>
                
                <div class="control-group">
                    <h3>ğŸ¨ ç›¸æ¡†è®¾ç½® <span class="lock-icon">ğŸ”„ æ–°ç›¸æ¡†è¦†ç›–æ—§ç›¸æ¡†</span></h3>
                    <p class="instruction">æ¯æ¬¡åº”ç”¨æ–°ç›¸æ¡†ä¼šè‡ªåŠ¨æ›¿æ¢æ—§ç›¸æ¡†</p>
                    
                    <div class="frame-preview">
                        <div class="frame-item" onclick="selectFrame('christmas')">
                            <img src="https://images.unsplash.com/photo-1544787219-7f47ccb76574?w=200&h=150&fit=crop&auto=format" alt="åœ£è¯">
                            <div class="frame-name">åœ£è¯ä¸»é¢˜</div>
                        </div>
                        <div class="frame-item" onclick="selectFrame('easter')">
                            <img src="https://images.unsplash.com/photo-1618519764620-7403abdbdfe9?w=200&h=150&fit=crop&auto=format" alt="å¤æ´»èŠ‚">
                            <div class="frame-name">å¤æ´»èŠ‚ä¸»é¢˜</div>
                        </div>
                        <div class="frame-item" onclick="selectFrame('chinese_new_year')">
                            <img src="https://images.unsplash.com/photo-1547981609-4b6bf67b7d12?w=200&h=150&fit=crop&auto=format" alt="æ˜¥èŠ‚">
                            <div class="frame-name">æ˜¥èŠ‚ä¸»é¢˜</div>
                        </div>
                        <div class="frame-item" onclick="selectFrame('thanksgiving')">
                            <img src="https://images.unsplash.com/photo-1633177314669-66f37c6d1cc1?w=200&h=150&fit=crop&auto=format" alt="æ„Ÿæ©èŠ‚">
                            <div class="frame-name">æ„Ÿæ©èŠ‚ä¸»é¢˜</div>
                        </div>
                    </div>
                    
                    <div class="custom-frame-input">
                        <input type="text" id="customFrameUrl" placeholder="ç²˜è´´ç›¸æ¡†å›¾ç‰‡ç½‘å€...">
                        <button onclick="addCustomFrame()">æ·»åŠ </button>
                    </div>
                    
                    <button class="btn" onclick="applySelectedFrame()">åº”ç”¨é€‰ä¸­ç›¸æ¡†</button>
                    <button class="btn btn-secondary" onclick="removeFrame()">ç§»é™¤ç›¸æ¡†</button>
                </div>
                
                <div class="control-group">
                    <h3>ğŸ‘ æ‰‹åŠ¿å›¾æ¡ˆ</h3>
                    <button class="btn" onclick="addSticker('praise', 'left')">ğŸ™Œ å·¦ä¸Šè§’</button>
                    <button class="btn" onclick="addSticker('praise', 'right')">ğŸ™Œ å³ä¸Šè§’</button>
                    <button class="btn" onclick="addSticker('prayer', 'left')">ğŸ™ å·¦ä¸Šè§’</button>
                    <button class="btn" onclick="addSticker('prayer', 'right')">ğŸ™ å³ä¸Šè§’</button>
                    
                    <div class="sticker-position-controls">
                        <button onclick="addSticker('celebration', 'left')">ğŸ‰ å·¦ä¸Šåº†ç¥</button>
                        <button onclick="addSticker('celebration', 'right')">ğŸ‰ å³ä¸Šåº†ç¥</button>
                        <button onclick="addSticker('blessing', 'left')">âœï¸ å·¦ä¸Šç¥ç¦</button>
                        <button onclick="addSticker('blessing', 'right')">âœï¸ å³ä¸Šç¥ç¦</button>
                    </div>
                    
                    <div class="custom-frame-input">
                        <input type="text" id="customStickerUrl" placeholder="ç²˜è´´æ‰‹åŠ¿å›¾ç‰‡ç½‘å€...">
                        <button onclick="addCustomSticker()">æ·»åŠ æ‰‹åŠ¿</button>
                    </div>
                </div>
                
                <div class="control-group">
                    <h3>ğŸ“ æ–‡å­—æ¡†</h3>
                    <button class="btn" onclick="addTextBox()">æ·»åŠ åº•éƒ¨æ–‡å­—æ¡†</button>
                    
                    <div class="color-picker">
                        <label>èƒŒæ™¯è‰²:</label>
                        <input type="color" id="textBgColor" value="#ffffff">
                        <label>æ–‡å­—è‰²:</label>
                        <input type="color" id="textColor" value="#2c3e50">
                    </div>
                    
                    <div class="text-style-controls">
                        <button onclick="changeTextBackground()">åº”ç”¨èƒŒæ™¯è‰²</button>
                        <button onclick="changeTextColor()">åº”ç”¨æ–‡å­—è‰²</button>
                        <button onclick="bringForward()">ä¸Šç§»ä¸€å±‚</button>
                        <button onclick="sendBackward()">ä¸‹ç§»ä¸€å±‚</button>
                    </div>
                </div>
                
                <div class="control-group">
                    <h3>ğŸ› ï¸ å·¥å…·</h3>
                    <button class="btn btn-secondary" onclick="clearAll()">æ¸…é™¤æ‰€æœ‰å…ƒç´ </button>
                    <button class="btn btn-success" onclick="downloadImage()">ğŸ’¾ ä¸‹è½½å›¾ç‰‡</button>
                </div>
            </div>
            
            <!-- å³ä¾§ä¸»å†…å®¹åŒº -->
            <div class="main-content">
                <div class="canvas-container">
                    <canvas id="canvas" width="800" height="500"></canvas>
                </div>
                
                <div class="instruction">
                    ğŸ’¡ æç¤ºï¼šæ‰‹åŠ¿æ”¾åœ¨å·¦ä¸Š/å³ä¸Šè§’ï¼Œæ–‡å­—æ¡†åœ¨åº•éƒ¨ï¼Œå¯è‡ªå®šä¹‰é¢œè‰²
                </div>
                
                <div id="statusMessage" class="status-message hidden"></div>
            </div>
        </div>
    </div>

    <script>
        // åˆå§‹åŒ–Fabric.jsç”»å¸ƒ
        const canvas = new fabric.Canvas('canvas');
        let backgroundFrame = null;
        let currentFrameType = null;
        let currentTextbox = null;

        // æ˜¾ç¤ºçŠ¶æ€æ¶ˆæ¯
        function showStatus(message, type = 'success') {
            const statusEl = document.getElementById('statusMessage');
            statusEl.textContent = message;
            statusEl.className = `status-message ${type}`;
            statusEl.classList.remove('hidden');
            
            setTimeout(() => {
                statusEl.classList.add('hidden');
            }, 3000);
        }

        // é€‰æ‹©ç›¸æ¡†
        function selectFrame(frameType) {
            // ç§»é™¤ä¹‹å‰çš„é€‰æ‹©
            document.querySelectorAll('.frame-item').forEach(item => {
                item.classList.remove('active');
            });
            
            // æ·»åŠ å½“å‰é€‰æ‹©
            event.target.closest('.frame-item').classList.add('active');
            currentFrameType = frameType;
            showStatus(`å·²é€‰æ‹© ${frameType} ç›¸æ¡†ï¼Œç‚¹å‡»"åº”ç”¨ç›¸æ¡†"æŒ‰é’®æ›¿æ¢å½“å‰ç›¸æ¡†`);
        }

        // åº”ç”¨é€‰ä¸­çš„ç›¸æ¡†ï¼ˆè‡ªåŠ¨è¦†ç›–æ—§çš„ï¼‰
        function applySelectedFrame() {
            if (!currentFrameType) {
                showStatus('è¯·å…ˆé€‰æ‹©ä¸€ä¸ªç›¸æ¡†ï¼', 'error');
                return;
            }
            
            const frameUrls = {
                christmas: 'https://images.unsplash.com/photo-1544787219-7f47ccb76574?w=800&h=600&fit=crop&auto=format',
                easter: 'https://images.unsplash.com/photo-1618519764620-7403abdbdfe9?w=800&h=600&fit=crop&auto=format',
                chinese_new_year: 'https://images.unsplash.com/photo-1547981609-4b6bf67b7d12?w=800&h=600&fit=crop&auto=format',
                thanksgiving: 'https://images.unsplash.com/photo-1633177314669-66f37c6d1cc1?w=800&h=600&fit=crop&auto=format'
            };
            
            loadFrame(frameUrls[currentFrameType]);
        }

        // åŠ è½½ç›¸æ¡†ä½œä¸ºåº•æ¿ï¼ˆè‡ªåŠ¨ç§»é™¤æ—§çš„ï¼‰
        function loadFrame(frameUrl) {
            showStatus('æ­£åœ¨åŠ è½½æ–°ç›¸æ¡†ï¼Œæ›¿æ¢æ—§ç›¸æ¡†...');
            
            fabric.Image.fromURL(frameUrl, function(newFrame) {
                // è‡ªåŠ¨ç§»é™¤ä¹‹å‰çš„ç›¸æ¡†
                if (backgroundFrame) {
                    canvas.remove(backgroundFrame);
                }
                
                // è®¾ç½®æ–°ç›¸æ¡†ä½œä¸ºåº•æ¿
                newFrame.set({
                    left: 0,
                    top: 0,
                    width: canvas.width,
                    height: canvas.height,
                    selectable: false,
                    hasControls: false,
                    hasBorders: false,
                    evented: false,
                    lockMovementX: true,
                    lockMovementY: true,
                    lockRotation: true,
                    lockScalingX: true,
                    lockScalingY: true,
                    excludeFromExport: false
                });
                
                canvas.add(newFrame);
                canvas.sendToBack(newFrame);
                backgroundFrame = newFrame;
                canvas.renderAll();
                
                showStatus('æ–°ç›¸æ¡†å·²æ›¿æ¢æ—§ç›¸æ¡†ï¼');
            }, null, { crossOrigin: 'anonymous' });
        }

        // æ·»åŠ è‡ªå®šä¹‰ç›¸æ¡†ï¼ˆè‡ªåŠ¨è¦†ç›–æ—§çš„ï¼‰
        function addCustomFrame() {
            const frameUrl = document.getElementById('customFrameUrl').value.trim();
            if (!frameUrl) {
                showStatus('è¯·è¾“å…¥å›¾ç‰‡ç½‘å€ï¼', 'error');
                return;
            }
            
            loadFrame(frameUrl);
            document.getElementById('customFrameUrl').value = '';
        }

        // ç§»é™¤ç›¸æ¡†
        function removeFrame() {
            if (backgroundFrame) {
                canvas.remove(backgroundFrame);
                backgroundFrame = null;
                showStatus('ç›¸æ¡†å·²ç§»é™¤');
            } else {
                showStatus('æ²¡æœ‰ç›¸æ¡†å¯ç§»é™¤', 'error');
            }
        }

        // ä¸Šä¼ å›¾ç‰‡å¤„ç†
        document.getElementById('imageUpload').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(f) {
                fabric.Image.fromURL(f.target.result, function(img) {
                    // è®¾ç½®å›¾ç‰‡åˆå§‹å¤§å°å’Œä½ç½®
                    const scale = Math.min(600 / img.width, 400 / img.height) * 0.8;
                    
                    img.set({
                        left: canvas.width / 2 - (img.width * scale) / 2,
                        top: canvas.height / 2 - (img.height * scale) / 2,
                        scaleX: scale,
                        scaleY: scale,
                        selectable: true,
                        hasControls: true,
                        cornerStyle: 'circle',
                        transparentCorners: false,
                        lockUniScaling: false
                    });
                    
                    canvas.add(img);
                    canvas.renderAll();
                    
                    showStatus('å›¾ç‰‡ä¸Šä¼ æˆåŠŸï¼å¯ä»¥æ‹–æ‹½è°ƒæ•´å¤§å°å’Œä½ç½®');
                });
            };
            reader.readAsDataURL(file);
        });

        // é¢„å®šä¹‰çš„æ‰‹åŠ¿å›¾æ¡ˆ
        const stickerUrls = {
            praise: 'https://images.unsplash.com/photo-1511795409834-ef04bbd61622?w=200&h=200&fit=crop&auto=format',
            prayer: 'https://images.unsplash.com/photo-1424746219973-8fe3bd07d8e3?w=200&h=200&fit=crop&auto=format',
            celebration: 'https://images.unsplash.com/photo-1533227268428-f9ed0900fb3b?w=200&h=200&fit=crop&auto=format',
            blessing: 'https://images.unsplash.com/photo-1518481852452-9415bceeba4d?w=200&h=200&fit=crop&auto=format'
        };

        // æ·»åŠ æ‰‹åŠ¿å›¾æ¡ˆï¼ˆæ”¾åœ¨å·¦ä¸Šæˆ–å³ä¸Šè§’ï¼‰
        function addSticker(stickerType, position = 'left') {
            const stickerUrl = stickerUrls[stickerType];
            if (!stickerUrl) return;
            
            fabric.Image.fromURL(stickerUrl, function(sticker) {
                // è®¾ç½®ä½ç½®ï¼šå·¦ä¸Šè§’æˆ–å³ä¸Šè§’
                const left = position === 'left' ? 50 : canvas.width - 150;
                const top = 50;
                
                sticker.set({
                    left: left,
                    top: top,
                    scaleX: 0.15,
                    scaleY: 0.15,
                    selectable: true,
                    hasControls: true,
                    cornerStyle: 'circle',
                    transparentCorners: false,
                    lockUniScaling: false
                });
                
                canvas.add(sticker);
                canvas.renderAll();
                showStatus(`æ‰‹åŠ¿å›¾æ¡ˆå·²æ·»åŠ åˆ°${position === 'left' ? 'å·¦ä¸Šè§’' : 'å³ä¸Šè§’'}ï¼`);
            }, null, { crossOrigin: 'anonymous' });
        }

        // æ·»åŠ è‡ªå®šä¹‰æ‰‹åŠ¿
        function addCustomSticker() {
            const stickerUrl = document.getElementById('customStickerUrl').value.trim();
            if (!stickerUrl) {
                showStatus('è¯·è¾“å…¥å›¾ç‰‡ç½‘å€ï¼', 'error');
                return;
            }
            
            fabric.Image.fromURL(stickerUrl, function(sticker) {
                sticker.set({
                    left: 50,
                    top: 50,
                    scaleX: 0.15,
                    scaleY: 0.15,
                    selectable: true,
                    hasControls: true,
                    cornerStyle: 'circle',
                    transparentCorners: false
                });
                
                canvas.add(sticker);
                canvas.renderAll();
                showStatus('è‡ªå®šä¹‰å›¾æ¡ˆå·²æ·»åŠ åˆ°å·¦ä¸Šè§’ï¼');
                document.getElementById('customStickerUrl').value = '';
            }, null, { crossOrigin: 'anonymous' });
        }

        // æ·»åŠ æ–‡å­—æ¡†ï¼ˆæ”¾åœ¨åº•éƒ¨ï¼‰
        function addTextBox() {
            const textContent = prompt('è¯·è¾“å…¥æ–‡å­—å†…å®¹:', 'æ¬¢è¿å‚åŠ è¯»ä¹¦ä¼šåˆ†äº«');
            if (!textContent) return;
            
            // ç§»é™¤ä¹‹å‰çš„æ–‡å­—æ¡†
            if (currentTextbox) {
                canvas.remove(currentTextbox);
            }
            
            const textbox = new fabric.Textbox(textContent, {
                left: canvas.width / 2 - 150,
                top: canvas.height - 100, // åº•éƒ¨ä½ç½®
                width: 300,
                fontSize: 24,
                fill: document.getElementById('textColor').value,
                fontFamily: 'Microsoft YaHei',
                backgroundColor: document.getElementById('textBgColor').value,
                padding: 15,
                borderColor: '#667eea',
                cornerColor: '#667eea',
                cornerStyle: 'circle',
                transparentCorners: false,
                selectable: true,
                hasControls: true,
                textAlign: 'center'
            });
            
            canvas.add(textbox);
            currentTextbox = textbox;
            canvas.renderAll();
            showStatus('æ–‡å­—æ¡†å·²æ·»åŠ åˆ°åº•éƒ¨ï¼å¯ä»¥è°ƒæ•´é¢œè‰²å’Œä½ç½®');
        }

        // ä¿®æ”¹æ–‡å­—èƒŒæ™¯è‰²
        function changeTextBackground() {
            if (currentTextbox) {
                const color = document.getElementById('textBgColor').value;
                currentTextbox.set('backgroundColor', color);
                canvas.renderAll();
                showStatus('æ–‡å­—èƒŒæ™¯è‰²å·²æ›´æ–°ï¼');
            } else {
                showStatus('è¯·å…ˆæ·»åŠ æ–‡å­—æ¡†ï¼', 'error');
            }
        }

        // ä¿®æ”¹æ–‡å­—é¢œè‰²
        function changeTextColor() {
            if (currentTextbox) {
                const color = document.getElementById('textColor').value;
                currentTextbox.set('fill', color);
                canvas.renderAll();
                showStatus('æ–‡å­—é¢œè‰²å·²æ›´æ–°ï¼');
            } else {
                showStatus('è¯·å…ˆæ·»åŠ æ–‡å­—æ¡†ï¼', 'error');
            }
        }

        // å›¾å±‚æ§åˆ¶
        function bringForward() {
            const activeObject = canvas.getActiveObject();
            if (activeObject && activeObject !== backgroundFrame) {
                canvas.bringForward(activeObject);
                showStatus('å…ƒç´ å·²ä¸Šç§»ä¸€å±‚');
            }
        }

        function sendBackward() {
            const activeObject = canvas.getActiveObject();
            if (activeObject && activeObject !== backgroundFrame) {
                canvas.sendBackwards(activeObject);
                showStatus('å…ƒç´ å·²ä¸‹ç§»ä¸€å±‚');
            }
        }

        // æ¸…é™¤æ‰€æœ‰å…ƒç´ ï¼ˆä¿ç•™ç›¸æ¡†ï¼‰
        function clearAll() {
            const objects = canvas.getObjects();
            objects.forEach(obj => {
                if (obj !== backgroundFrame) {
                    canvas.remove(obj);
                }
            });
            currentTextbox = null;
            showStatus('å·²æ¸…é™¤æ‰€æœ‰å†…å®¹ï¼ˆç›¸æ¡†ä¿ç•™ï¼‰');
        }

        // ä¿®å¤ä¸‹è½½åŠŸèƒ½
        function downloadImage() {
            if (canvas.getObjects().length === 0) {
                showStatus('ç”»å¸ƒä¸ºç©ºï¼Œæ— æ³•ä¸‹è½½', 'error');
                return;
            }
            
            // åˆ›å»ºä¸€ä¸ªä¸´æ—¶é“¾æ¥è¿›è¡Œä¸‹è½½
            const link = document.createElement('a');
            link.download = `è¯»ä¹¦ä¼šå›¾ç‰‡_${new Date().getTime()}.png`;
            
            // ä½¿ç”¨ toDataURLWithMultiplier æé«˜å›¾ç‰‡è´¨é‡
            canvas.setViewportTransform([1, 0, 0, 1, 0, 0]);
            const dataURL = canvas.toDataURL({
                format: 'png',
                quality: 1,
                multiplier: 2 // æé«˜åˆ†è¾¨ç‡
            });
            
            link.href = dataURL;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            showStatus('å›¾ç‰‡ä¸‹è½½æˆåŠŸï¼');
        }

        // åˆå§‹æç¤º
        showStatus('è¯·å…ˆé€‰æ‹©ç›¸æ¡†ä½œä¸ºåº•æ¿ï¼Œç„¶åä¸Šä¼ Zoomæˆªå›¾');
    </script>
</body>
</html>
