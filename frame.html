<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è¯»ä¹¦ä¼šå›¾ç‰‡ç¼–è¾‘å™¨</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fabric.js/5.3.0/fabric.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Microsoft YaHei', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            overflow: hidden;
        }
        
        .header {
            background: #2c3e50;
            color: white;
            padding: 20px;
            text-align: center;
        }
        
        .header h1 {
            font-size: 2.2em;
            margin-bottom: 10px;
        }
        
        .header p {
            opacity: 0.8;
        }
        
        .content {
            display: flex;
            min-height: 600px;
        }
        
        .sidebar {
            width: 300px;
            background: #f8f9fa;
            padding: 20px;
            border-right: 1px solid #e9ecef;
        }
        
        .main-content {
            flex: 1;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }
        
        .upload-area {
            border: 2px dashed #667eea;
            border-radius: 10px;
            padding: 30px;
            text-align: center;
            margin-bottom: 20px;
            background: #f8f9ff;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .upload-area:hover {
            background: #eef2ff;
            border-color: #764ba2;
        }
        
        .control-group {
            margin-bottom: 25px;
        }
        
        .control-group h3 {
            color: #2c3e50;
            margin-bottom: 15px;
            padding-bottom: 5px;
            border-bottom: 2px solid #667eea;
        }
        
        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            margin: 5px;
            transition: all 0.3s;
            width: calc(100% - 10px);
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }
        
        .btn-secondary {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        }
        
        .canvas-container {
            border: 2px solid #e9ecef;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        
        #canvas {
            background: #f8f9fa;
        }
        
        .download-btn {
            background: linear-gradient(135deg, #4ecdc4 0%, #44a08d 100%);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            transition: all 0.3s;
        }
        
        .download-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(78, 205, 196, 0.4);
        }
        
        .status-message {
            margin-top: 10px;
            padding: 10px;
            border-radius: 5px;
            text-align: center;
            font-size: 14px;
        }
        
        .success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        .hidden {
            display: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ“š è¯»ä¹¦ä¼šå›¾ç‰‡ç¼–è¾‘å™¨</h1>
            <p>ä¸ºZoomæˆªå›¾æ·»åŠ ç›¸æ¡†ã€æ‰‹åŠ¿å›¾æ¡ˆå’Œæ–‡å­—æ¡†</p>
        </div>
        
        <div class="content">
            <!-- å·¦ä¾§æ§åˆ¶é¢æ¿ -->
            <div class="sidebar">
                <div class="upload-area" onclick="document.getElementById('imageUpload').click()">
                    <h3>ğŸ“ ä¸Šä¼ Zoomæˆªå›¾</h3>
                    <p>ç‚¹å‡»æˆ–æ‹–æ‹½å›¾ç‰‡åˆ°è¿™é‡Œ</p>
                    <input type="file" id="imageUpload" accept="image/*" class="hidden">
                </div>
                
                <div class="control-group">
                    <h3>ğŸ¨ ç›¸æ¡†è®¾ç½®</h3>
                    <button class="btn" onclick="addFrame('christmas')">ğŸ„ åœ£è¯ä¸»é¢˜</button>
                    <button class="btn" onclick="addFrame('easter')">ğŸ° å¤æ´»èŠ‚ä¸»é¢˜</button>
                    <button class="btn" onclick="addFrame('chinese_new_year')">ğŸ® æ˜¥èŠ‚ä¸»é¢˜</button>
                    <button class="btn" onclick="addFrame('thanksgiving')">ğŸ¦ƒ æ„Ÿæ©èŠ‚ä¸»é¢˜</button>
                    <button class="btn" onclick="addFrame('general')">ğŸŒŸ é€šç”¨ç›¸æ¡†</button>
                </div>
                
                <div class="control-group">
                    <h3>ğŸ‘ æ‰‹åŠ¿å›¾æ¡ˆ</h3>
                    <button class="btn" onclick="addSticker('praise')">ğŸ™Œ èµç¾æ‰‹åŠ¿</button>
                    <button class="btn" onclick="addSticker('prayer')">ğŸ™ ç¥ˆç¥·æ‰‹åŠ¿</button>
                    <button class="btn" onclick="addSticker('celebration')">ğŸ‰ åº†ç¥æ‰‹åŠ¿</button>
                    <button class="btn" onclick="addSticker('blessing')">âœï¸ ç¥ç¦æ‰‹åŠ¿</button>
                </div>
                
                <div class="control-group">
                    <h3>ğŸ“ æ–‡å­—æ¡†</h3>
                    <button class="btn" onclick="addTextBox()">æ·»åŠ æ–‡å­—æ¡†</button>
                    <button class="btn btn-secondary" onclick="clearAll()">æ¸…é™¤æ‰€æœ‰å…ƒç´ </button>
                </div>
            </div>
            
            <!-- å³ä¾§ä¸»å†…å®¹åŒº -->
            <div class="main-content">
                <div class="canvas-container">
                    <canvas id="canvas" width="800" height="500"></canvas>
                </div>
                
                <div id="statusMessage" class="status-message hidden"></div>
                
                <button class="download-btn" onclick="downloadImage()">
                    ğŸ’¾ ä¸‹è½½å›¾ç‰‡
                </button>
            </div>
        </div>
    </div>

    <script>
        // åˆå§‹åŒ–Fabric.jsç”»å¸ƒ
        const canvas = new fabric.Canvas('canvas', {
            backgroundColor: '#f8f9fa'
        });
        
        let originalImage = null;
        const IMAGE_POSITION = { left: 50, top: 80 }; // å›ºå®šå›¾ç‰‡ä½ç½®ï¼Œä¸ºç›¸æ¡†ç•™å‡ºç©ºé—´

        // æ˜¾ç¤ºçŠ¶æ€æ¶ˆæ¯
        function showStatus(message, type = 'success') {
            const statusEl = document.getElementById('statusMessage');
            statusEl.textContent = message;
            statusEl.className = `status-message ${type}`;
            statusEl.classList.remove('hidden');
            
            setTimeout(() => {
                statusEl.classList.add('hidden');
            }, 3000);
        }

        // ä¸Šä¼ å›¾ç‰‡å¤„ç†
        document.getElementById('imageUpload').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(f) {
                fabric.Image.fromURL(f.target.result, function(img) {
                    canvas.clear();
                    
                    // è®¾ç½®å›¾ç‰‡ä½ç½®ï¼ˆå›ºå®šä½ç½®ï¼‰
                    img.set({
                        left: IMAGE_POSITION.left,
                        top: IMAGE_POSITION.top,
                        selectable: true,
                        hasControls: true
                    });
                    
                    canvas.add(img);
                    originalImage = img;
                    canvas.renderAll();
                    
                    showStatus('å›¾ç‰‡ä¸Šä¼ æˆåŠŸï¼ç°åœ¨å¯ä»¥æ·»åŠ ç›¸æ¡†å’Œå›¾æ¡ˆäº†ã€‚');
                });
            };
            reader.readAsDataURL(file);
        });

        // é¢„å®šä¹‰çš„ç›¸æ¡†å’Œå›¾æ¡ˆèµ„æºï¼ˆä½¿ç”¨åœ¨çº¿èµ„æºï¼‰
        const resources = {
            frames: {
                christmas: 'https://images.unsplash.com/photo-1544787219-7f47ccb76574?w=800&h=600&fit=crop&auto=format',
                easter: 'https://images.unsplash.com/photo-1618519764620-7403abdbdfe9?w=800&h=600&fit=crop&auto=format',
                chinese_new_year: 'https://images.unsplash.com/photo-1547981609-4b6bf67b7d12?w=800&h=600&fit=crop&auto=format',
                thanksgiving: 'https://images.unsplash.com/photo-1633177314669-66f37c6d1cc1?w=800&h=600&fit=crop&auto=format',
                general: 'https://images.unsplash.com/photo-1513475382585-d06e58bcb0e0?w=800&h=600&fit=crop&auto=format'
            },
            stickers: {
                praise: 'https://images.unsplash.com/photo-1511795409834-ef04bbd61622?w=200&h=200&fit=crop&auto=format',
                prayer: 'https://images.unsplash.com/photo-1424746219973-8fe3bd07d8e3?w=200&h=200&fit=crop&auto=format',
                celebration: 'https://images.unsplash.com/photo-1533227268428-f9ed0900fb3b?w=200&h=200&fit=crop&auto=format',
                blessing: 'https://images.unsplash.com/photo-1518481852452-9415bceeba4d?w=200&h=200&fit=crop&auto=format'
            }
        };

        // æ·»åŠ ç›¸æ¡†
        async function addFrame(frameType) {
            if (!originalImage) {
                showStatus('è¯·å…ˆä¸Šä¼ å›¾ç‰‡ï¼', 'error');
                return;
            }
            
            showStatus('æ­£åœ¨æ·»åŠ ç›¸æ¡†...');
            
            try {
                const frameUrl = resources.frames[frameType] || resources.frames.general;
                
                fabric.Image.fromURL(frameUrl, function(frame) {
                    // è®¾ç½®ç›¸æ¡†è¦†ç›–æ•´ä¸ªç”»å¸ƒ
                    frame.set({
                        left: 0,
                        top: 0,
                        width: canvas.width,
                        height: canvas.height,
                        selectable: false,
                        evented: false,
                        opacity: 0.7
                    });
                    
                    canvas.add(frame);
                    canvas.sendToBack(frame); // å°†ç›¸æ¡†æ”¾åˆ°æœ€åº•å±‚
                    canvas.renderAll();
                    
                    showStatus('ç›¸æ¡†æ·»åŠ æˆåŠŸï¼');
                });
            } catch (error) {
                showStatus('ç›¸æ¡†æ·»åŠ å¤±è´¥ï¼Œè¯·é‡è¯•', 'error');
                console.error('Frame error:', error);
            }
        }

        // æ·»åŠ æ‰‹åŠ¿å›¾æ¡ˆ
        async function addSticker(stickerType) {
            if (!originalImage) {
                showStatus('è¯·å…ˆä¸Šä¼ å›¾ç‰‡ï¼', 'error');
                return;
            }
            
            showStatus('æ­£åœ¨æ·»åŠ æ‰‹åŠ¿å›¾æ¡ˆ...');
            
            try {
                const stickerUrl = resources.stickers[stickerType] || resources.stickers.praise;
                
                fabric.Image.fromURL(stickerUrl, function(sticker) {
                    // è®¾ç½®å›¾æ¡ˆä½ç½®å’Œå¤§å°
                    sticker.set({
                        left: 600, // å³ä¾§ä½ç½®
                        top: 400,  // åº•éƒ¨ä½ç½®
                        scaleX: 0.15,
                        scaleY: 0.15,
                        cornerStyle: 'circle',
                        transparentCorners: false
                    });
                    
                    canvas.add(sticker);
                    canvas.renderAll();
                    
                    showStatus('æ‰‹åŠ¿å›¾æ¡ˆæ·»åŠ æˆåŠŸï¼');
                });
            } catch (error) {
                showStatus('å›¾æ¡ˆæ·»åŠ å¤±è´¥ï¼Œè¯·é‡è¯•', 'error');
                console.error('Sticker error:', error);
            }
        }

        // æ·»åŠ æ–‡å­—æ¡†
        function addTextBox() {
            if (!originalImage) {
                showStatus('è¯·å…ˆä¸Šä¼ å›¾ç‰‡ï¼', 'error');
                return;
            }
            
            const textContent = prompt('è¯·è¾“å…¥æ–‡å­—å†…å®¹:', 'æ¬¢è¿å‚åŠ è¯»ä¹¦ä¼šåˆ†äº«');
            if (!textContent) return;
            
            const textbox = new fabric.Textbox(textContent, {
                left: 100,
                top: 50,
                width: 300,
                fontSize: 24,
                fill: '#2c3e50',
                fontFamily: 'Microsoft YaHei',
                backgroundColor: 'rgba(255, 255, 255, 0.9)',
                padding: 10,
                borderColor: '#667eea',
                cornerColor: '#667eea',
                cornerStyle: 'circle',
                transparentCorners: false
            });
            
            canvas.add(textbox);
            canvas.renderAll();
            showStatus('æ–‡å­—æ¡†æ·»åŠ æˆåŠŸï¼å¯ä»¥æ‹–åŠ¨è°ƒæ•´ä½ç½®');
        }

        // æ¸…é™¤æ‰€æœ‰æ·»åŠ çš„å…ƒç´ 
        function clearAll() {
            if (!originalImage) {
                showStatus('æ²¡æœ‰å¯æ¸…é™¤çš„å†…å®¹', 'error');
                return;
            }
            
            canvas.clear();
            canvas.add(originalImage);
            canvas.renderAll();
            showStatus('å·²æ¸…é™¤æ‰€æœ‰æ·»åŠ çš„å…ƒç´ ');
        }

        // ä¸‹è½½å›¾ç‰‡
        function downloadImage() {
            if (!originalImage) {
                showStatus('è¯·å…ˆä¸Šä¼ å›¾ç‰‡ï¼', 'error');
                return;
            }
            
            const dataURL = canvas.toDataURL({
                format: 'png',
                quality: 1
            });
            
            const link = document.createElement('a');
            link.download = `è¯»ä¹¦ä¼šå›¾ç‰‡_${new Date().getTime()}.png`;
            link.href = dataURL;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            showStatus('å›¾ç‰‡ä¸‹è½½æˆåŠŸï¼');
        }

        // åˆå§‹æç¤º
        showStatus('è¯·ä¸Šä¼ Zoomæˆªå›¾å¼€å§‹ç¼–è¾‘');
    </script>
</body>
</html>
