<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>è¯»ä¹¦ä¼šå›¾ç‰‡ç¼–è¾‘å™¨</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fabric.js/5.3.0/fabric.min.js"></script>
    <script src="https://unpkg.com/tesseract.js@v2.1.0/dist/tesseract.min.js"></script>
</head>
<body>
    <div id="app">
        <h1>ğŸ“š è¯»ä¹¦ä¼šå›¾ç‰‡ç¼–è¾‘å™¨</h1>
        
        <!-- æ–‡ä»¶ä¸Šä¼  -->
        <input type="file" id="imageUpload" accept="image/*">
        
        <!-- ç¼–è¾‘åŒºåŸŸ -->
        <div>
            <canvas id="canvas" width="800" height="600"></canvas>
        </div>
        
        <!-- æ§åˆ¶é¢æ¿ -->
        <div>
            <button onclick="addFrame()">æ·»åŠ ç›¸æ¡†</button>
            <button onclick="addSticker()">æ·»åŠ æ‰‹åŠ¿å›¾æ¡ˆ</button>
            <button onclick="addTextBox()">æ·»åŠ æ–‡å­—æ¡†</button>
            <button onclick="saveToGoogleDrive()">ä¿å­˜åˆ°Google Drive</button>
        </div>
    </div>

    <script>
        // åˆå§‹åŒ–Fabric.jsç”»å¸ƒ
        const canvas = new fabric.Canvas('canvas');
        let currentImage = null;

        // ä¸Šä¼ å›¾ç‰‡
        document.getElementById('imageUpload').addEventListener('change', function(e) {
            const file = e.target.files[0];
            const reader = new FileReader();
            
            reader.onload = function(f) {
                fabric.Image.fromURL(f.target.result, function(img) {
                    canvas.clear();
                    canvas.add(img);
                    currentImage = img;
                    canvas.renderAll();
                });
            };
            reader.readAsDataURL(file);
        });

        // æ·»åŠ ç›¸æ¡†
        async function addFrame() {
            const occasion = prompt('è¯·è¾“å…¥èŠ‚æ—¥ï¼ˆå¦‚ï¼šåœ£è¯ã€æ˜¥èŠ‚ã€æ„Ÿæ©èŠ‚ï¼‰:');
            const frameUrl = await searchFrame(occasion);
            
            fabric.Image.fromURL(frameUrl, function(frame) {
                frame.set({
                    left: 0,
                    top: 0,
                    selectable: false
                });
                canvas.add(frame);
                canvas.renderAll();
            });
        }

        // æœç´¢ç›¸æ¡†ç´ æ
        async function searchFrame(occasion) {
            // ä½¿ç”¨å…è´¹çš„å›¾ç‰‡API
            const response = await fetch(`https://api.unsplash.com/search/photos?query=${occasion}+frame&client_id=YOUR_UNSPLASH_KEY`);
            const data = await response.json();
            return data.results[0].urls.regular;
        }

        // æ·»åŠ æ‰‹åŠ¿å›¾æ¡ˆ
        async function addSticker() {
            const gestureType = prompt('æ‰‹åŠ¿ç±»å‹ï¼ˆèµç¾ã€ç¥ˆç¥·ã€åº†ç¥ï¼‰:');
            const stickerUrl = await searchSticker(gestureType);
            
            fabric.Image.fromURL(stickerUrl, function(sticker) {
                sticker.set({
                    left: 100,
                    top: 100,
                    scaleX: 0.3,
                    scaleY: 0.3
                });
                canvas.add(sticker);
                canvas.renderAll();
            });
        }

        // æ·»åŠ è‡ªé€‚åº”æ–‡å­—æ¡†
        function addTextBox() {
            const text = prompt('è¯·è¾“å…¥æ–‡å­—å†…å®¹:');
            
            const textbox = new fabric.Textbox(text, {
                left: 50,
                top: 50,
                width: 200,
                fontSize: 20,
                fill: '#000000',
                backgroundColor: 'rgba(255,255,255,0.8)',
                editable: true
            });
            
            canvas.add(textbox);
            canvas.renderAll();
        }

        // ä¿å­˜åˆ°Google Drive
        async function saveToGoogleDrive() {
            const dataURL = canvas.toDataURL({
                format: 'png',
                quality: 1
            });
            
            // ä½¿ç”¨Google Picker API
            await saveToDrive(dataURL);
        }

        // ä½¿ç”¨Google Picker APIä¿å­˜
        function saveToDrive(dataURL) {
            // è¿™é‡Œéœ€è¦é…ç½®Google API
            // æˆ–è€…æä¾›ä¸‹è½½é“¾æ¥ï¼Œè®©ç”¨æˆ·æ‰‹åŠ¨ä¿å­˜åˆ°Drive
            const link = document.createElement('a');
            link.download = 'è¯»ä¹¦ä¼šå›¾ç‰‡.png';
            link.href = dataURL;
            link.click();
        }
    </script>
</body>
</html>
